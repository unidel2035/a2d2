# Техническая спецификация проекта A2D2

## 1. Введение

### 1.1 Цель документа
Данный документ содержит техническую спецификацию системы управления роботизацией и интеллектуальными агентами "A2D2".

### 1.2 Область применения
Система предназначена для коммерческих организаций, внедряющих роботизацию и ИИ-агенты для:
- Автоматизации бизнес-процессов
- Инспекции и мониторинга
- Анализа данных
- Управления документооборотом
- Процессной автоматизации

### 1.3 Термины и определения
- **Робот** - роботизированная система или ИИ-агент
- **ТО** - техническое обслуживание
- **Задание** - задача, выполняемая роботом или агентом
- **Телеметрия** - данные, получаемые от роботизированных систем в процессе работы
- **Оператор** - лицо, управляющее роботизированной системой или агентом

## 2. Общие требования

### 2.1 Функциональные требования

#### 2.1.1 Управление роботизированными системами
- Регистрация новых роботов и ИИ-агентов в системе
- Хранение технических характеристик и параметров агентов
- Учет идентификаторов и конфигураций систем
- Отслеживание статуса (активен, на ТО, в ремонте, выведен из эксплуатации)
- История изменений технических параметров

#### 2.1.2 Документооборот
- Загрузка документов в форматах: PDF, DOC, DOCX, JPG, PNG
- Максимальный размер файла: 50 МБ
- Категоризация документов по типам
- Версионирование документов
- Полнотекстовый поиск
- Права доступа на уровне документа

#### 2.1.3 Операции и задания
- Планирование заданий с указанием:
  - Даты и времени
  - Параметров выполнения
  - Назначенной роботизированной системы
  - Назначенного оператора
  - Цели задания
- Автоматическая регистрация задания при загрузке данных телеметрии
- Хранение логов выполнения
- Контекстные данные на момент выполнения задания

#### 2.1.4 Техническое обслуживание
- Создание графика ТО на основе:
  - Времени работы систем
  - Календарных сроков
  - Количества выполненных операций
- Уведомления за 7 дней до планового ТО
- Регистрация выполненных работ
- Учет заменённых компонентов
- История ТО для каждой роботизированной системы

#### 2.1.5 Инспекции
- Создание инспекционного задания
- Загрузка медиафайлов (фото, видео) до 2 ГБ на задание
- Геопривязка каждого медиафайла
- Аннотации и комментарии к медиа
- Формирование отчета в PDF
- Экспорт данных в форматах: PDF, Excel, KML

#### 2.1.6 Управление персоналом
- Регистрация операторов с личными данными
- Загрузка сертификатов и свидетельств
- Отслеживание срока действия допусков
- Учет налета часов
- Ограничение доступа к функциям на основе квалификации

#### 2.1.7 Аналитика
- Дашборд с ключевыми метриками:
  - Общее время работы систем
  - Количество выполненных заданий за период
  - Загруженность роботизированных систем
  - Предстоящие ТО
- Графики и диаграммы
- Экспорт отчетов в Excel и PDF

### 2.2 Нефункциональные требования

#### 2.2.1 Производительность
- Время отклика веб-интерфейса: не более 2 секунд
- Одновременная работа: до 100 пользователей
- Время загрузки главной страницы: не более 1 секунды
- Обработка загрузки файла 50 МБ: не более 30 секунд

#### 2.2.2 Безопасность
- Шифрование данных в транспорте: TLS 1.3
- Шифрование данных в покое: AES-256
- Аутентификация: многофакторная (опционально)
- Сессии: автоматическое завершение через 30 минут неактивности
- Пароли: минимум 8 символов, хеширование bcrypt
- Логирование всех действий пользователей
- Резервное копирование: ежедневное

#### 2.2.3 Надежность
- Доступность системы: 99.5%
- Резервное копирование: каждые 24 часа
- Восстановление после сбоя: не более 4 часов
- Валидация данных на клиенте и сервере

#### 2.2.4 Масштабируемость
- Поддержка до 1000 роботизированных систем в системе
- Хранилище документов: до 1 ТБ
- Горизонтальное масштабирование веб-серверов
- Вертикальное масштабирование базы данных

#### 2.2.5 Совместимость
- Браузеры: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- Мобильные устройства: iOS 14+, Android 10+
- Экспорт данных в стандартных форматах
- API для интеграции с внешними системами

#### 2.2.6 Удобство использования
- Интерфейс на русском и английском языках
- Адаптивный дизайн (responsive)
- Контекстная справка
- Обучающие подсказки для новых пользователей

## 3. Архитектура системы

### 3.1 Общая архитектура
```
┌─────────────────────────────────────────────────────┐
│                 Presentation Layer                  │
│  (Web Interface, Mobile App, API)                   │
└────────────────┬────────────────────────────────────┘
                 │
┌────────────────▼────────────────────────────────────┐
│              Application Layer                      │
│  (Rails Controllers, Business Logic)                │
└────────────────┬────────────────────────────────────┘
                 │
┌────────────────▼────────────────────────────────────┐
│               Data Layer                            │
│  (Active Record Models, Database)                   │
└─────────────────────────────────────────────────────┘
```

### 3.2 Компоненты системы

#### 3.2.1 Frontend
- **Framework**: Hotwire (Turbo + Stimulus)
- **CSS**: Tailwind CSS (опционально) или Custom CSS
- **JavaScript**: Vanilla JS + Stimulus controllers
- **Charts**: Chart.js для графиков и диаграмм

#### 3.2.2 Backend
- **Framework**: Ruby on Rails 8.1
- **Language**: Ruby 3.3.6
- **Architecture**: MVC pattern
- **Background Jobs**: Solid Queue
- **Caching**: Solid Cache

#### 3.2.3 База данных
- **Development**: SQLite3
- **Production**: PostgreSQL 14+
- **Миграции**: Rails migrations
- **ORM**: Active Record

#### 3.2.4 File Storage
- **Development**: Local filesystem
- **Production**: Amazon S3 или аналогичное объектное хранилище
- **Active Storage**: для управления файлами

#### 3.2.5 Deployment
- **Containerization**: Docker
- **Orchestration**: Kamal 2.8.1
- **Web Server**: Puma
- **Reverse Proxy**: Nginx (опционально)
- **SSL**: Let's Encrypt

## 4. Модели данных

### 4.1 Основные сущности

#### 4.1.1 Robot (Робот)
```ruby
class Robot < ApplicationRecord
  # Атрибуты
  - manufacturer: string        # Производитель
  - model: string              # Модель
  - serial_number: string      # Серийный номер
  - registration_number: string # Регистрационный номер
  - specifications: json       # Технические характеристики
  - capabilities: json         # Возможности и функции
  - configuration: json        # Конфигурация системы
  - status: enum               # Статус (active, maintenance, repair, retired)
  - purchase_date: date        # Дата покупки
  - last_maintenance: date     # Последнее ТО
  - total_operation_hours: decimal # Общее время работы
  - total_tasks: integer       # Общее количество заданий

  # Связи
  has_many :tasks
  has_many :documents
  has_many :maintenance_records
end
```

#### 4.1.2 Task (Задание)
```ruby
class Task < ApplicationRecord
  # Атрибуты
  - task_number: string        # Номер задания
  - planned_date: datetime     # Плановое время
  - actual_start: datetime     # Фактическое начало
  - actual_end: datetime       # Фактическое окончание
  - duration: integer          # Длительность (минуты)
  - purpose: string            # Цель задания
  - location: string           # Местоположение
  - parameters: json           # Параметры выполнения
  - context_data: string       # Контекстные данные
  - status: enum               # Статус (planned, in_progress, completed, cancelled)

  # Связи
  belongs_to :robot
  belongs_to :operator, class_name: 'User'
  has_one :telemetry_data
  has_many :inspection_reports
end
```

#### 4.1.3 Document (Документ)
```ruby
class Document < ApplicationRecord
  # Атрибуты
  - title: string              # Название
  - description: text          # Описание
  - category: enum             # Категория (passport, certificate, manual, report)
  - version: string            # Версия
  - issue_date: date           # Дата выпуска
  - expiry_date: date          # Дата окончания действия

  # Связи
  belongs_to :robot
  has_one_attached :file
end
```

#### 4.1.4 MaintenanceRecord (Запись ТО)
```ruby
class MaintenanceRecord < ApplicationRecord
  # Атрибуты
  - scheduled_date: date       # Плановая дата
  - completed_date: date       # Дата выполнения
  - maintenance_type: enum     # Тип (routine, repair, component_replacement)
  - description: text          # Описание работ
  - cost: decimal              # Стоимость
  - next_maintenance_date: date # Следующее ТО
  - operation_hours_at_maintenance: decimal # Время работы на момент ТО

  # Связи
  belongs_to :robot
  belongs_to :technician, class_name: 'User'
  has_many :replaced_components
end
```

#### 4.1.5 User (Пользователь/Оператор)
```ruby
class User < ApplicationRecord
  # Атрибуты
  - email: string              # Email
  - encrypted_password: string # Пароль (зашифрованный)
  - first_name: string         # Имя
  - last_name: string          # Фамилия
  - role: enum                 # Роль (admin, operator, technician, viewer)
  - license_number: string     # Номер свидетельства
  - license_expiry: date       # Срок действия свидетельства
  - total_flight_hours: decimal # Общий налет

  # Связи
  has_many :flights, foreign_key: 'operator_id'
  has_many :maintenance_records, foreign_key: 'technician_id'
end
```

#### 4.1.6 InspectionReport (Инспекционный отчет)
```ruby
class InspectionReport < ApplicationRecord
  # Атрибуты
  - report_number: string      # Номер отчета
  - inspection_date: date      # Дата инспекции
  - location: string           # Местоположение
  - coordinates: string        # Координаты
  - object_type: string        # Тип объекта
  - findings: text             # Выявленные проблемы
  - recommendations: text      # Рекомендации
  - status: enum               # Статус (draft, completed, approved)

  # Связи
  belongs_to :task
  has_many_attached :photos
  has_many_attached :videos
end
```

## 5. API Спецификация

### 5.1 RESTful API

#### 5.1.1 Эндпоинты роботов
```
GET    /api/v1/robots           # Список роботов
GET    /api/v1/robots/:id       # Информация о роботе
POST   /api/v1/robots           # Создание робота
PATCH  /api/v1/robots/:id       # Обновление робота
DELETE /api/v1/robots/:id       # Удаление робота
```

#### 5.1.2 Эндпоинты заданий
```
GET    /api/v1/tasks            # Список заданий
GET    /api/v1/tasks/:id        # Информация о задании
POST   /api/v1/tasks            # Создание задания
PATCH  /api/v1/tasks/:id        # Обновление задания
POST   /api/v1/tasks/:id/telemetry  # Загрузка телеметрии
```

#### 5.1.3 Аутентификация
```
POST   /api/v1/auth/login       # Вход
POST   /api/v1/auth/logout      # Выход
POST   /api/v1/auth/refresh     # Обновление токена
```

### 5.2 Формат данных
- Формат обмена: JSON
- Encoding: UTF-8
- Аутентификация: JWT токены
- Валидация: JSON Schema

### 5.3 Пример запроса
```json
POST /api/v1/robots
Authorization: Bearer {token}
Content-Type: application/json

{
  "robot": {
    "manufacturer": "RoboTech",
    "model": "Agent Pro",
    "serial_number": "ABC123456",
    "registration_number": "RU-001",
    "specifications": {
      "type": "ai_agent",
      "capabilities": ["analysis", "validation"]
    },
    "status": "active"
  }
}
```

### 5.4 Пример ответа
```json
{
  "status": "success",
  "data": {
    "id": 1,
    "manufacturer": "RoboTech",
    "model": "Agent Pro",
    "serial_number": "ABC123456",
    "registration_number": "RU-001",
    "specifications": {
      "type": "ai_agent",
      "capabilities": ["analysis", "validation"]
    },
    "status": "active",
    "created_at": "2025-01-15T10:30:00Z",
    "updated_at": "2025-01-15T10:30:00Z"
  }
}
```

## 6. Безопасность

### 6.1 Аутентификация и авторизация
- Devise для аутентификации пользователей
- Pundit для авторизации (policy-based)
- Ролевая модель (RBAC)

### 6.2 Роли и разрешения

#### Administrator
- Полный доступ ко всем функциям
- Управление пользователями
- Системные настройки

#### Operator
- Создание и управление заданиями
- Просмотр роботизированных систем
- Создание инспекционных отчетов

#### Technician
- Управление ТО
- Просмотр технической документации
- Обновление статусов роботизированных систем

#### Viewer
- Только чтение
- Просмотр отчетов
- Экспорт данных

### 6.3 Защита данных
- SQL injection: параметризованные запросы (Active Record)
- XSS: автоматическое экранирование в Rails
- CSRF: защита токенами
- Secure Headers: установка безопасных заголовков
- Rate Limiting: ограничение запросов к API

## 7. Тестирование

### 7.1 Виды тестирования
- **Unit Tests**: тестирование моделей и сервисов
- **Integration Tests**: тестирование контроллеров
- **System Tests**: end-to-end тестирование с браузером
- **Security Tests**: Brakeman для статического анализа

### 7.2 Покрытие кода
- Минимальное покрытие: 80%
- Инструмент: SimpleCov

### 7.3 Continuous Integration
- GitHub Actions для автоматического тестирования
- Запуск тестов при каждом push и pull request

## 8. Развертывание

### 8.1 Окружения
- **Development**: локальная разработка
- **Staging**: тестовый сервер
- **Production**: боевой сервер

### 8.2 Требования к серверу (Production)

#### Минимальные
- CPU: 2 cores
- RAM: 4 GB
- Disk: 50 GB SSD
- Bandwidth: 100 Mbps

#### Рекомендуемые
- CPU: 4 cores
- RAM: 8 GB
- Disk: 100 GB SSD
- Bandwidth: 1 Gbps

### 8.3 Процесс развертывания
1. Build Docker образа
2. Push в container registry
3. Kamal deploy на production сервер
4. Запуск миграций базы данных
5. Перезапуск приложения
6. Health check

## 9. Мониторинг и логирование

### 9.1 Мониторинг
- Uptime monitoring
- Performance metrics
- Error tracking (Sentry или аналог)
- Database performance

### 9.2 Логирование
- Application logs: Rails.logger
- Access logs: Nginx/Puma
- Error logs: отдельный файл
- Ротация логов: ежедневно

## 10. Резервное копирование

### 10.1 База данных
- Ежедневное полное копирование
- Хранение копий: 30 дней
- Автоматическое восстановление из копии

### 10.2 Файлы
- Синхронизация с объектным хранилищем
- Версионирование файлов
- Географическая репликация (для критичных данных)

## 11. План разработки

### 11.1 Фаза 1: MVP (8 недель)
- Недели 1-2: Настройка инфраструктуры, базовая аутентификация
- Недели 3-4: Модуль управления роботизированными системами
- Недели 5-6: Модуль заданий и операций
- Недели 7-8: Модуль документации, тестирование, развертывание

### 11.2 Фаза 2: Расширенный функционал (8 недель)
- Недели 9-10: Модуль ТО
- Недели 11-12: Модуль инспекций
- Недели 13-14: Аналитика и отчеты
- Недели 15-16: API, тестирование, оптимизация

### 11.3 Фаза 3: Дополнительные возможности (4 недели)
- Недели 17-18: Интеграция ИИ-агентов
- Недели 19-20: Расширенные интеграции, финальное тестирование

## 12. Критерии приемки

### 12.1 Функциональность
- ✓ Все функциональные требования реализованы
- ✓ Интерфейс интуитивно понятен
- ✓ Нет критических ошибок

### 12.2 Производительность
- ✓ Время отклика соответствует требованиям
- ✓ Система выдерживает нагрузку 100 одновременных пользователей

### 12.3 Безопасность
- ✓ Пройдены тесты на проникновение
- ✓ Нет критических уязвимостей

### 12.4 Документация
- ✓ Техническая документация актуальна
- ✓ Пользовательская документация доступна
- ✓ API документирован

---

**Версия документа**: 1.0
**Дата**: 23 октября 2025
**Статус**: Утверждено

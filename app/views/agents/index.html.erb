<div class="container mx-auto px-4 py-8">
  <h1 class="text-3xl font-bold mb-6">Agent Orchestration Dashboard</h1>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8">
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-gray-500 text-sm font-medium">Total Agents</h3>
      <p class="text-3xl font-bold"><%= @stats[:total] %></p>
    </div>
    <div class="bg-green-50 rounded-lg shadow p-6">
      <h3 class="text-gray-500 text-sm font-medium">Active</h3>
      <p class="text-3xl font-bold text-green-600"><%= @stats[:active] %></p>
    </div>
    <div class="bg-blue-50 rounded-lg shadow p-6">
      <h3 class="text-gray-500 text-sm font-medium">Idle</h3>
      <p class="text-3xl font-bold text-blue-600"><%= @stats[:idle] %></p>
    </div>
    <div class="bg-yellow-50 rounded-lg shadow p-6">
      <h3 class="text-gray-500 text-sm font-medium">Busy</h3>
      <p class="text-3xl font-bold text-yellow-600"><%= @stats[:busy] %></p>
    </div>
    <div class="bg-red-50 rounded-lg shadow p-6">
      <h3 class="text-gray-500 text-sm font-medium">Failed</h3>
      <p class="text-3xl font-bold text-red-600"><%= @stats[:failed] %></p>
    </div>
  </div>

  <!-- Agents Table -->
  <div class="bg-white rounded-lg shadow mb-8">
    <div class="px-6 py-4 border-b border-gray-200">
      <h2 class="text-xl font-semibold">Registered Agents</h2>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Health Score</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Capabilities</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Heartbeat</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% @agents.each do |agent| %>
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap">
                <%= link_to agent.name, agent_path(agent), class: "text-blue-600 hover:text-blue-900 font-medium" %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap"><%= agent.agent_type %></td>
              <td class="px-6 py-4 whitespace-nowrap">
                <% status_class = case agent.status
                   when 'idle' then 'bg-green-100 text-green-800'
                   when 'busy' then 'bg-yellow-100 text-yellow-800'
                   when 'failed' then 'bg-red-100 text-red-800'
                   else 'bg-gray-100 text-gray-800'
                   end %>
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <%= status_class %>">
                  <%= agent.status %>
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="flex-1 h-2 bg-gray-200 rounded-full mr-2">
                    <% score_class = agent.health_score >= 70 ? 'bg-green-500' : (agent.health_score >= 50 ? 'bg-yellow-500' : 'bg-red-500') %>
                    <div class="h-2 rounded-full <%= score_class %>" style="width: <%= agent.health_score %>%"></div>
                  </div>
                  <span class="text-sm text-gray-700"><%= agent.health_score.to_i %>%</span>
                </div>
              </td>
              <td class="px-6 py-4">
                <% if agent.capabilities.present? %>
                  <div class="flex flex-wrap gap-1">
                    <% agent.capabilities.first(3).each do |cap| %>
                      <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded"><%= cap %></span>
                    <% end %>
                    <% if agent.capabilities.size > 3 %>
                      <span class="px-2 py-1 text-xs bg-gray-100 text-gray-800 rounded">+<%= agent.capabilities.size - 3 %></span>
                    <% end %>
                  </div>
                <% else %>
                  <span class="text-gray-400 text-sm">None</span>
                <% end %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <%= agent.last_heartbeat ? time_ago_in_words(agent.last_heartbeat) + ' ago' : 'Never' %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <%= link_to 'View', agent_path(agent), class: "text-blue-600 hover:text-blue-900" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Recent Tasks -->
  <div class="bg-white rounded-lg shadow">
    <div class="px-6 py-4 border-b border-gray-200">
      <h2 class="text-xl font-semibold">Recent Tasks</h2>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Agent</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% @recent_tasks.each do |task| %>
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap text-sm font-mono">#<%= task.id %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"><%= task.task_type %></td>
              <td class="px-6 py-4 whitespace-nowrap">
                <% status_class = case task.status
                   when 'completed' then 'bg-green-100 text-green-800'
                   when 'running' then 'bg-blue-100 text-blue-800'
                   when 'failed' then 'bg-red-100 text-red-800'
                   else 'bg-gray-100 text-gray-800'
                   end %>
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <%= status_class %>">
                  <%= task.status %>
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <%= task.agent ? link_to(task.agent.name, agent_path(task.agent), class: "text-blue-600 hover:text-blue-900") : '-' %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"><%= task.priority %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <%= time_ago_in_words(task.created_at) %> ago
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>

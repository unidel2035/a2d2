# –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏

**–î–∞—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**: 29 –æ–∫—Ç—è–±—Ä—è 2025
**Issue**: [#98](https://github.com/unidel2035/a2d2/issues/98)
**PR**: [#118](https://github.com/unidel2035/a2d2/pull/118)
**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: ROB-004, SPECIFICATION.md —Å—Ç—Ä–æ–∫–∞ 58

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –ø—Ä–µ–¥—Å—Ç–æ—è—â–µ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏ —Ä–æ–±–æ—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º. –†–µ–∞–ª–∏–∑—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ SPECIFICATION.md –æ —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –æ –ø–ª–∞–Ω–æ–≤—ã—Ö —Ä–∞–±–æ—Ç–∞—Ö.

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞:
- **7 –¥–Ω–µ–π** –¥–æ –ø–ª–∞–Ω–æ–≤–æ–≥–æ –¢–û
- **3 –¥–Ω—è** –¥–æ –ø–ª–∞–Ω–æ–≤–æ–≥–æ –¢–û
- **1 –¥–µ–Ω—å** –¥–æ –ø–ª–∞–Ω–æ–≤–æ–≥–æ –¢–û

### 2. –¢–∏–ø—ã –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π

**–¢–µ—Ö–Ω–∏–∫–∏**
- –ü–æ–ª—É—á–∞—é—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Ä–∞–±–æ—Ç–∞—Ö
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ –∑–∞–ø—á–∞—Å—Ç–µ–π
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞—Ä–∞–±–æ—Ç–∫–µ —Ä–æ–±–æ—Ç–∞ –∏ –∏—Å—Ç–æ—Ä–∏–∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è

**–û–ø–µ—Ä–∞—Ç–æ—Ä—ã**
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ä–æ–±–æ—Ç–∞
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é —Ç–µ–∫—É—â–∏—Ö –∑–∞–¥–∞—á
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á

### 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –∂—É—Ä–Ω–∞–ª `notification_logs` –¥–ª—è:
- –ê—É–¥–∏—Ç–∞ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ê–Ω–∞–ª–∏–∑–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```
MaintenanceNotificationJob ‚îÄ‚î¨‚îÄ> MaintenanceMailer ‚îÄ‚îÄ> Email (–¢–µ—Ö–Ω–∏–∫)
                            ‚îÇ                      ‚îî‚îÄ‚îÄ> Email (–û–ø–µ—Ä–∞—Ç–æ—Ä)
                            ‚îî‚îÄ> NotificationLog ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```

### –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
app/
‚îú‚îÄ‚îÄ jobs/
‚îÇ   ‚îî‚îÄ‚îÄ maintenance_notification_job.rb     # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ mailers/
‚îÇ   ‚îî‚îÄ‚îÄ maintenance_mailer.rb               # Email —Ä–∞—Å—Å—ã–ª–∫–∞
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ notification_log.rb                 # –ú–æ–¥–µ–ª—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ views/
    ‚îî‚îÄ‚îÄ maintenance_mailer/
        ‚îú‚îÄ‚îÄ upcoming_maintenance_technician.html.erb
        ‚îú‚îÄ‚îÄ upcoming_maintenance_technician.text.erb
        ‚îú‚îÄ‚îÄ upcoming_maintenance_operator.html.erb
        ‚îî‚îÄ‚îÄ upcoming_maintenance_operator.text.erb

config/
‚îî‚îÄ‚îÄ schedule.rb                             # –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ cron

db/
‚îî‚îÄ‚îÄ migrate/
    ‚îî‚îÄ‚îÄ 20251029150000_create_notification_logs.rb

test/
‚îú‚îÄ‚îÄ jobs/
‚îÇ   ‚îî‚îÄ‚îÄ maintenance_notification_job_test.rb
‚îú‚îÄ‚îÄ mailers/
‚îÇ   ‚îî‚îÄ‚îÄ maintenance_mailer_test.rb
‚îî‚îÄ‚îÄ models/
    ‚îî‚îÄ‚îÄ notification_log_test.rb
```

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

```ruby
# –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
MaintenanceNotificationJob.perform_now

# –û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å
MaintenanceNotificationJob.perform_later
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ

Job –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00 —É—Ç—Ä–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –≤ `config/schedule.rb`:

```ruby
every 1.day, at: "9:00 am" do
  runner "MaintenanceNotificationJob.perform_now"
end
```

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è cron –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ whenever
bundle exec whenever --update-crontab

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
bundle exec whenever --write-crontab
crontab -l
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```ruby
# –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏–∫–∞
MaintenanceMailer.upcoming_maintenance_technician(
  maintenance_record,
  days_before
).deliver_later

# –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
MaintenanceMailer.upcoming_maintenance_operator(
  maintenance_record,
  operator,
  days_before
).deliver_later
```

## üìä –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

### NotificationLog

–•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:

```ruby
create_table :notification_logs do |t|
  t.references :notifiable, polymorphic: true, null: false
  t.string :notification_type, null: false
  t.text :recipients                      # JSON array
  t.integer :days_before
  t.date :scheduled_date
  t.datetime :sent_at, null: false
  t.text :metadata                        # JSON
  t.timestamps
end
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```ruby
# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ —Å–µ–≥–æ–¥–Ω—è
NotificationLog.sent_today

# –ü–æ–ª—É—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¢–û
NotificationLog.for_maintenance

# –ü–æ–ª—É—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ –¢–û
maintenance_record.notification_logs

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
NotificationLog.where(notification_type: "maintenance_reminder")
  .where("sent_at >= ?", 1.month.ago)
  .group(:days_before)
  .count
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
rails test

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã job
rails test test/jobs/maintenance_notification_job_test.rb

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã mailer
rails test test/mailers/maintenance_mailer_test.rb

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã –º–æ–¥–µ–ª–∏
rails test test/models/notification_log_test.rb
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

- **MaintenanceNotificationJob**: 11 —Ç–µ—Å—Ç–æ–≤
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –æ—á–µ—Ä–µ–¥—å
  - –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ (7, 3, 1 –¥–µ–Ω—å)
  - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É –∑–∞–ø–∏—Å–∏ –¢–û
  - –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–≥–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- **MaintenanceMailer**: 15 —Ç–µ—Å—Ç–æ–≤
  - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
  - –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ç–µ–º—ã –ø–∏—Å—å–º–∞
  - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∏—Å–µ–º (HTML –∏ —Ç–µ–∫—Å—Ç)
  - –ù–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  - –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

- **NotificationLog**: 16 —Ç–µ—Å—Ç–æ–≤
  - –í–∞–ª–∏–¥–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏
  - –ü–æ–ª–∏–º–æ—Ä—Ñ–Ω—ã–µ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏
  - –°–∫–æ—É–ø—ã –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
  - –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è JSON
  - –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã

**–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ**: 42 —Ç–µ—Å—Ç–∞

## üìß –®–∞–±–ª–æ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –î–ª—è —Ç–µ—Ö–Ω–∏–∫–æ–≤

**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –∏–º–µ–Ω–µ–º —Ç–µ—Ö–Ω–∏–∫–∞
- –î–µ—Ç–∞–ª–∏ –ø—Ä–µ–¥—Å—Ç–æ—è—â–µ–≥–æ –¢–û:
  - –°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å —Ä–æ–±–æ—Ç–∞
  - –î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –¢–û
  - –¢–∏–ø –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
  - –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ä–æ–±–æ—Ç–∞
  - –¢–µ–∫—É—â–∞—è –Ω–∞—Ä–∞–±–æ—Ç–∫–∞
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –∑–∞–ø–∏—Å–∏ –¢–û

**–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞**: –ó–µ–ª–µ–Ω–∞—è (—É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)

### –î–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤

**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –∏–º–µ–Ω–µ–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ä–æ–±–æ—Ç–∞
- –î–µ—Ç–∞–ª–∏ –¢–û:
  - –°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä —Ä–æ–±–æ—Ç–∞
  - –î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è
  - –¢–∏–ø –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
  - –ö–æ–Ω—Ç–∞–∫—Ç—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç–µ—Ö–Ω–∏–∫–∞
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:
  - –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏
  - –ù–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –Ω–∞ –¥–∞—Ç—É –¢–û
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø—Ä–∏ —Å—Ä–æ—á–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö

**–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞**: –°–∏–Ω—è—è (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è)

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —à–∞–±–ª–æ–Ω–æ–≤

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ HTML –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –≤–µ—Ä—Å–∏–π
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –í–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–æ—á–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (1 –¥–µ–Ω—å –¥–æ –¢–û)
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–∫–ª–æ–Ω–µ–Ω–∏–µ —Å–ª–æ–≤ ("–¥–µ–Ω—å", "–¥–Ω—è", "–¥–Ω–µ–π")

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–í —Ñ–∞–π–ª–µ `app/jobs/maintenance_notification_job.rb`:

```ruby
# –ò–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã (–≤ –¥–Ω—è—Ö)
NOTIFICATION_INTERVALS = [7, 3, 1].freeze

# –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
NOTIFICATION_INTERVALS = [14, 7, 3, 1].freeze
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏

–í —Ñ–∞–π–ª–µ `config/schedule.rb`:

```ruby
# –ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
every 1.day, at: "8:00 am" do  # –±—ã–ª–æ 9:00 am
  runner "MaintenanceNotificationJob.perform_now"
end

# –ò–ª–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –¥–µ–Ω—å
every 12.hours do
  runner "MaintenanceNotificationJob.perform_now"
end
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è email

–í —Ñ–∞–π–ª–µ `app/mailers/application_mailer.rb`:

```ruby
default from: "noreply@yourdomain.com"  # –ò–∑–º–µ–Ω–∏—Ç—å –∞–¥—Ä–µ—Å
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```ruby
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
NotificationLog.recent.limit(10)

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
NotificationLog.sent_today.count

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–µ–π –¢–û, —Ç—Ä–µ–±—É—é—â–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
MaintenanceRecord
  .where(status: :scheduled)
  .where(scheduled_date: [
    Date.current + 7.days,
    Date.current + 3.days,
    Date.current + 1.day
  ])
```

### –õ–æ–≥–∏

–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –≤ `log/cron.log` –∏ `log/cron_error.log`:

```
Starting maintenance notification check at 2025-10-29 09:00:00 +0300
Found 3 maintenance records scheduled for 2025-11-05 (7 days from now)
Sent technician notification for MaintenanceRecord #15 to tech@example.com
Sent operator notification for MaintenanceRecord #15 to operator@example.com
Maintenance notification check completed: 3 notifications sent, 0 errors
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP –≤ `config/environments/production.rb`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∑–∞–ø–∏—Å–µ–π –¢–û —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–ø–∏—Å–µ–π (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `scheduled`)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `tail -f log/cron.log`

### Cron –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å crontab
crontab -l

# –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
bundle exec whenever --update-crontab

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ cron
sudo tail -f /var/log/syslog | grep CRON
```

### –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç

```bash
# –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –∞–∫—Ç—É–∞–ª—å–Ω–∞
rails db:test:prepare

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
rails db:migrate RAILS_ENV=test

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å fixtures –∏ factory
rails test:models
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏

```ruby
# –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
NotificationLog.count

# –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü
NotificationLog.where("sent_at >= ?", 1.month.ago).count

# –°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
NotificationLog.average(:recipient_count)

# –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º
NotificationLog.group(:days_before).count

# –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è vs –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¢–û)
maintenance_with_notifications = NotificationLog
  .for_maintenance
  .distinct
  .count(:notifiable_id)

completed_maintenance = MaintenanceRecord
  .where(status: :completed)
  .count
```

## üîÑ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

1. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã**
   - SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
   - Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
   - Telegram/Slack –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

2. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è**
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
   - –í—ã–±–æ—Ä –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ —Å–≤—è–∑–∏
   - –ß–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

3. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞**
   - Dashboard —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
   - –û—Ç—á–µ—Ç—ã –æ –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç–∏
   - A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤

4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞–ª–µ–Ω–¥–∞—Ä—è–º–∏**
   - –≠–∫—Å–ø–æ—Ä—Ç –≤ Google Calendar / Outlook
   - iCal —Ñ–∞–π–ª—ã –≤ –ø–∏—Å—å–º–∞—Ö
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [SPECIFICATION.md](../SPECIFICATION.md) - –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ
- [ROB-004: Technical Maintenance](../docs/phase-1-mbse/01-SR-001-FUNCTIONAL-REQUIREMENTS.md)
- Issue [#90](https://github.com/unidel2035/a2d2/issues/90) - –ê—É–¥–∏—Ç —Å–∏—Å—Ç–µ–º—ã
- Issue [#93](https://github.com/unidel2035/a2d2/issues/93) - REST API –¥–ª—è MaintenanceRecord

## üë• –ê–≤—Ç–æ—Ä—ã

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö Issue #98 –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ A2D2
–î–∞—Ç–∞: 29 –æ–∫—Ç—è–±—Ä—è 2025
